webpackJsonp([62],{BCLz:function(e,o,t){"use strict";Object.defineProperty(o,"__esModule",{value:!0});var a=t("ZLEe"),i=t.n(a),r=t("3cXf"),s=t.n(r),l=t("22Zk"),n=(l.a,{name:"hot_update",components:{InputArea:l.a},data:function(){return{currentPage:1,pageSize:10,total:0,dialogTitle:"",formLabelWidth:"100px",dialogFormVisible:!1,dialogVisible:!1,tableData:[],form:{versionUpd:{radio:"*"},versionUpdCustom:"",channelUpd:{radio:"*"},channelUpdCustom:"",forbidUpdVersion:{radio:"*"},forbidUpdVersionCustom:"",forbidUpdChannel:{radio:"*"},forbidUpdChannelCustom:"",isPublic:{radio:"*"},isPublicCustom:"",updStatus:{radio:"1"},checkList:["1","2","3"],updateTime:"",version:"",update_type:"",update_way:"",androidConfig:{},iosConfig:{},windowsConfig:{},game_info:""},fileData:{file:{},num:0,count:0,version:"",total_size:0,file_name:""},formData:{},imageUrl:"",pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var o=new Date;o.setTime(o.getTime()-864e5),e.$emit("pick",o)}},{text:"一周前",onClick:function(e){var o=new Date;o.setTime(o.getTime()-6048e5),e.$emit("pick",o)}}]},loading:!1,showProgress:!1,percentage:0}},filters:{formatPlatform:function(e){var o="",t=e.split(",");if(1==t.length)return 1==t[a]?o+="安卓":2==t[a]?o+="ios":o+="windows",o;for(var a=0;a<t.length;a++)1==t[a]?o+="安卓,":2==t[a]?o+="ios,":o+="windows";return o}},methods:{resetForm:function(){this.form={versionUpd:{radio:"*"},versionUpdCustom:"",channelUpd:{radio:"*"},channelUpdCustom:"",forbidUpdVersion:{radio:"*"},forbidUpdVersionCustom:"",forbidUpdChannel:{radio:"*"},forbidUpdChannelCustom:"",isPublic:{radio:"*"},isPublicCustom:"",updStatus:{radio:"1"},checkList:["1","2","3"],updateTime:"",version:"",update_type:"",update_way:""}},getHotUpdateList:function(){var e=this;this.$http.get("v1/backend/sys-conf/hot-update",{params:{page:this.currentPage,limit:this.pageSize}}).then(function(o){200===o.data.code&&(e.tableData=o.data.data,e.total=o.data.total)})},openAddDialog:function(){this.resetForm(),this.dialogTitle="添加信息",this.dialogFormVisible=!0,this.percentage=0},addUpdateConf:function(){var e=this,o={allow_version:"*"===this.form.versionUpd.radio?this.form.versionUpd.radio:this.form.versionUpdCustom,allow_channel:"*"===this.form.channelUpd.radio?this.form.channelUpd.radio:this.form.channelUpdCustom,deny_version:"*"===this.form.forbidUpdVersion.radio?this.form.forbidUpdVersion.radio:this.form.forbidUpdVersionCustom,deny_channel:"*"===this.form.forbidUpdChannel.radio?this.form.forbidUpdChannel.radio:this.form.forbidUpdChannelCustom,is_public:"*"===this.form.isPublic.radio?this.form.isPublic.radio:this.form.isPublicCustom,status:Number(this.form.updStatus.radio),clients:String(this.form.checkList),release_time:this.form.updateTime?parseInt(new Date(Number(this.form.updateTime)).getTime()/1e3):0,version_num:this.form.version,is_force:Number(this.form.update_type),update_type:Number(this.form.update_way),game_info:this.form.game_info};this.$http.post("v1/backend/sys-conf/hot-update",o).then(function(o){console.log(o),200===o.data.code&&(e.dialogFormVisible=!1,e.getHotUpdateList(),e.$message({type:"success",message:o.data.msg}))})},handleEdit:function(e){console.log(e),this.dialogTitle="编辑",this.dialogFormVisible=!0,this.form.id=e.id,"*"===e.allow_version?this.form.versionUpd.radio=e.allow_version:(this.form.versionUpd.radio="custom",this.form.versionUpdCustom=e.allow_version),"*"===e.allow_channel?this.form.channelUpd.radio=e.allow_channel:(this.form.channelUpd.radio="custom",this.form.channelUpdCustom=e.allow_version),"*"===e.deny_version?this.form.forbidUpdVersion.radio=e.deny_version:(this.form.forbidUpdVersion.radio="custom",this.form.forbidUpdVersionCustom=e.deny_version),"*"===e.deny_channel?this.form.forbidUpdChannel.radio=e.deny_channel:(this.form.forbidUpdChannel.radio="custom",this.form.forbidUpdChannelCustom=e.deny_channel),"*"===e.is_public?this.form.isPublic.radio=e.is_public:(this.form.isPublic.radio="custom",this.form.isPublicCustom=e.is_public),this.form.updStatus.radio=String(e.status),this.form.checkList=e.platform.split(","),this.form.updateTime=e.release_time,this.form.version=e.version,this.form.update_type=String(e.is_force),this.form.update_way=String(e.update_type),this.form.androidConfig=this.formatResource(JSON.parse(e.game_info).android),this.form.iosConfig=this.formatResource(JSON.parse(e.game_info).ios),this.form.windowsConfig=this.formatResource(JSON.parse(e.game_info).windows)},handleDelete:function(e){var o=this;console.log(e),this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.$http.delete("v1/backend/sys-conf/hot-update",{params:{version_id:e.id}}).then(function(e){console.log(e),200===e.data.code&&(o.getHotUpdateList(),o.$message({type:"success",message:e.data.msg}))})}).catch(function(){o.$message({type:"info",message:res.data.msg})})},handleSizeChange:function(e){this.pageSize=e,this.getHotUpdateList()},handleCurrentChange:function(e){this.currentPage=e,this.getHotUpdateList()},handleAvatarSuccess:function(e,o){},handleChange:function(e,o){console.log(o)},uploadChunk:function(e,o){new FileReader;var t=Math.ceil(e.size/104857600);console.log(t);var a=104857600*o,i=a+104857600>=e.size?e.size:a+104857600;this.fileData.file=e.slice(a,i),this.fileData.num=o,this.fileData.version=this.form.version,this.fileData.count=t,this.fileData.total_size=e.size,this.fileData.file_name=e.name},loadNext:function(){var e=currentChunk*chunkSize,o=e+chunkSize>=file.size?file.size:e+chunkSize;fileReader.readAsBinaryString(file.slice(e,o))},beforeUpload:function(e){},uploadFile:function(e){console.log(e.file);var o=e.file,t=0;if(""==this.form.version)return this.$message({type:"error",message:"请先填写更新版本号"}),!1;var a=this;a.loading=!0,a.showProgress=!0,a.percentage=0,function e(){var i=Math.ceil(o.size/104857600);console.log(i);var r=104857600*t,l=r+104857600>=o.size?o.size:r+104857600;a.fileData.file=o.slice(r,l),a.fileData.num=t,a.fileData.version=a.form.version,a.fileData.count=i,a.fileData.total_size=o.size,a.fileData.file_name=o.name;var n=new FormData;n.append("file",a.fileData.file),n.append("num",a.fileData.num),n.append("count",a.fileData.count),n.append("version",a.form.version),n.append("total_size",a.fileData.total_size),n.append("file_name",a.fileData.file_name);var d={onUploadProgress:function(e){a.percentage=Number(((e.loaded+104857600*t)/o.size*100).toFixed(2))||0,console.log(a.percentage)}};a.$http.post("v1/backend/sys-conf/hot-update/package",n,d).then(function(o){console.log(o),200===o.data.code?(t+=1,console.log(t),t<i&&e(),o.data.data.list&&(a.showProgress=!1,a.form.game_info=s()(o.data.data.list),a.form.androidConfig=a.formatResource(o.data.data.list.android),a.form.iosConfig=a.formatResource(o.data.data.list.ios),a.form.windowsConfig=a.formatResource(o.data.data.list.windows),a.loading=!1,a.$message({type:"success",message:"资源包上传成功"}))):(a.loading=!1,a.showProgress=!1,a.$message({type:"error",message:"资源包上传失败"}))})}()},formatResource:function(e){console.log(e);var o="";for(var t in e){var a=e[t];o+=t+"项目配置地址:";for(var r=i()(a),s=r.length-1;s>=1;s--)o+=a[r[s]];o+="\n"}return o}},mounted:function(){this.getHotUpdateList()}}),d={render:function(){var e=this,o=e.$createElement,t=e._self._c||o;return t("div",{attrs:{id:"hotUpdate-main"}},[e.showProgress?t("div",{staticClass:"mask"},[e.showProgress?t("el-progress",{staticClass:"progress",attrs:{"text-inside":!0,"stroke-width":26,percentage:e.percentage}}):e._e(),e._v(" "),100==e.percentage?t("span",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:e.loading,expression:"loading",modifiers:{fullscreen:!0}}],attrs:{"element-loading-text":"资源包整合中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.2)"}}):e._e()],1):e._e(),e._v(" "),t("input-area",[t("div",{staticStyle:{"margin-bottom":"10px"}},[t("el-button",{directives:[{name:"has",rawName:"v-has",value:"add_hot_update",expression:"'add_hot_update'"}],attrs:{type:"primary",size:"medium"},on:{click:e.openAddDialog}},[e._v("添加")])],1)]),e._v(" "),t("div",{staticClass:"bd"},[t("el-table",{directives:[{name:"has",rawName:"v-has",value:"hot_update_records",expression:"'hot_update_records'"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,"tooltip-effect":"dark"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"version",label:"更新版本",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"is_force",label:"是否强更",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[1===o.row.is_force?t("span",[e._v("强更")]):e._e(),e._v(" "),0===o.row.is_force?t("span",[e._v("非强更")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"update_type",label:"类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[1===o.row.update_type?t("span",[e._v("热更")]):e._e(),e._v(" "),0===o.row.update_type?t("span",[e._v("apk更新")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"allow_version",label:"允许版本",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return["*"===o.row.allow_version?t("span",[e._v("所有")]):t("span",[e._v(e._s(o.row.allow_version))])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"allow_channel",label:"允许渠道",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return["*"===o.row.allow_channel?t("span",[e._v("所有")]):t("span",[e._v(e._s(o.row.allow_channel))])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"platform",label:"平台",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("span",[e._v(e._s(e._f("formatPlatform")(o.row.platform)))])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"is_public",label:"版本公开",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return["*"===o.row.is_public?t("span",[e._v("所有")]):t("span",[e._v(e._s(o.row.is_public))])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(o){return[1===o.row.status?t("span",[e._v("启用")]):e._e(),e._v(" "),2===o.row.status?t("span",[e._v("禁止")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"modified_time",label:"更新时间",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("span",[e._v(e._s(e._f("dateFormat")(o.row.modified_time)))])]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"action",label:"操作",fixed:"right",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(o){return[t("el-button",{directives:[{name:"has",rawName:"v-has",value:"modify_hot_update",expression:"'modify_hot_update'"}],attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleEdit(o.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{directives:[{name:"has",rawName:"v-has",value:"delete_hot_update",expression:"'delete_hot_update'"}],attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(o.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),t("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.currentPage,"page-sizes":[10,15,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible,width:"65%"},on:{"update:visible":function(o){e.dialogFormVisible=o}}},[t("el-form",{attrs:{model:e.form}},[t("el-form-item",{attrs:{label:"允许版本更新","label-width":e.formLabelWidth}},[t("el-radio",{attrs:{label:"*"},model:{value:e.form.versionUpd.radio,callback:function(o){e.$set(e.form.versionUpd,"radio",o)},expression:"form.versionUpd.radio"}},[e._v("所有版本")]),e._v(" "),t("el-radio",{attrs:{label:"custom"},model:{value:e.form.versionUpd.radio,callback:function(o){e.$set(e.form.versionUpd,"radio",o)},expression:"form.versionUpd.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.versionUpd.radio?t("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.versionUpdCustom,callback:function(o){e.$set(e.form,"versionUpdCustom",o)},expression:"form.versionUpdCustom"}}):e._e()],1),e._v(" "),t("el-form-item",{attrs:{label:"允许更新渠道","label-width":e.formLabelWidth}},[t("el-radio",{attrs:{label:"*"},model:{value:e.form.channelUpd.radio,callback:function(o){e.$set(e.form.channelUpd,"radio",o)},expression:"form.channelUpd.radio"}},[e._v("所有版本")]),e._v(" "),t("el-radio",{attrs:{label:"custom"},model:{value:e.form.channelUpd.radio,callback:function(o){e.$set(e.form.channelUpd,"radio",o)},expression:"form.channelUpd.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.channelUpd.radio?t("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.channelUpdCustom,callback:function(o){e.$set(e.form,"channelUpdCustom",o)},expression:"form.channelUpdCustom"}}):e._e()],1),e._v(" "),t("el-form-item",{attrs:{label:"不允许更新版本","label-width":e.formLabelWidth}},[t("el-radio",{attrs:{label:"*"},model:{value:e.form.forbidUpdVersion.radio,callback:function(o){e.$set(e.form.forbidUpdVersion,"radio",o)},expression:"form.forbidUpdVersion.radio"}},[e._v("无")]),e._v(" "),t("el-radio",{attrs:{label:"custom"},model:{value:e.form.forbidUpdVersion.radio,callback:function(o){e.$set(e.form.forbidUpdVersion,"radio",o)},expression:"form.forbidUpdVersion.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.forbidUpdVersion.radio?t("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.forbidUpdVersionCustom,callback:function(o){e.$set(e.form,"forbidUpdVersionCustom",o)},expression:"form.forbidUpdVersionCustom"}}):e._e()],1),e._v(" "),t("el-form-item",{attrs:{label:"不允许更新渠道","label-width":e.formLabelWidth}},[t("el-radio",{attrs:{label:"*"},model:{value:e.form.forbidUpdChannel.radio,callback:function(o){e.$set(e.form.forbidUpdChannel,"radio",o)},expression:"form.forbidUpdChannel.radio"}},[e._v("无")]),e._v(" "),t("el-radio",{attrs:{label:"custom"},model:{value:e.form.forbidUpdChannel.radio,callback:function(o){e.$set(e.form.forbidUpdChannel,"radio",o)},expression:"form.forbidUpdChannel.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.forbidUpdChannel.radio?t("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.forbidUpdChannelCustom,callback:function(o){e.$set(e.form,"forbidUpdChannelCustom",o)},expression:"form.forbidUpdChannelCustom"}}):e._e()],1),e._v(" "),t("el-form-item",{attrs:{label:"是否公开","label-width":e.formLabelWidth}},[t("el-radio",{attrs:{label:"*"},model:{value:e.form.isPublic.radio,callback:function(o){e.$set(e.form.isPublic,"radio",o)},expression:"form.isPublic.radio"}},[e._v("所有人更新")]),e._v(" "),t("el-radio",{attrs:{label:"custom"},model:{value:e.form.isPublic.radio,callback:function(o){e.$set(e.form.isPublic,"radio",o)},expression:"form.isPublic.radio"}},[e._v("内部人更新")]),e._v(" "),"custom"===e.form.isPublic.radio?t("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.isPublicCustom,callback:function(o){e.$set(e.form,"isPublicCustom",o)},expression:"form.isPublicCustom"}}):e._e()],1),e._v(" "),t("el-form-item",{attrs:{label:"更新状态","label-width":e.formLabelWidth}},[t("el-radio",{attrs:{label:"1"},model:{value:e.form.updStatus.radio,callback:function(o){e.$set(e.form.updStatus,"radio",o)},expression:"form.updStatus.radio"}},[e._v("启用")]),e._v(" "),t("el-radio",{attrs:{label:"2"},model:{value:e.form.updStatus.radio,callback:function(o){e.$set(e.form.updStatus,"radio",o)},expression:"form.updStatus.radio"}},[e._v("禁用")])],1),e._v(" "),t("el-form-item",{attrs:{label:"更新客户端","label-width":e.formLabelWidth}},[t("el-checkbox-group",{model:{value:e.form.checkList,callback:function(o){e.$set(e.form,"checkList",o)},expression:"form.checkList"}},[t("el-checkbox",{attrs:{label:"1"}},[e._v("android")]),e._v(" "),t("el-checkbox",{attrs:{label:"2"}},[e._v("ios")]),e._v(" "),t("el-checkbox",{attrs:{label:"3"}},[e._v("windows")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"更新时间","label-width":e.formLabelWidth}},[t("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",align:"right","picker-options":e.pickerOptions},model:{value:e.form.updateTime,callback:function(o){e.$set(e.form,"updateTime",o)},expression:"form.updateTime"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"更新版本号","label-width":e.formLabelWidth}},[t("el-input",{attrs:{autocomplete:"off",placeholder:"请输入更新版本号"},model:{value:e.form.version,callback:function(o){e.$set(e.form,"version",o)},expression:"form.version"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"更新类型","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择更新类型"},model:{value:e.form.update_type,callback:function(o){e.$set(e.form,"update_type",o)},expression:"form.update_type"}},[t("el-option",{attrs:{label:"强更",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"非强更",value:"0"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"更新方式","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择更新方式"},model:{value:e.form.update_way,callback:function(o){e.$set(e.form,"update_way",o)},expression:"form.update_way"}},[t("el-option",{attrs:{label:"热更",value:"1"}}),e._v(" "),t("el-option",{attrs:{label:"整包更新",value:"0"}})],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"上传资源包","label-width":e.formLabelWidth}},[t("el-upload",{staticClass:"avatar-uploader",attrs:{"element-loading-background":"rgba(0, 0, 0, 0.5)",action:"",accept:".zip","show-file-list":!1,"on-change":e.handleChange,"before-upload":e.beforeUpload,"on-success":e.handleAvatarSuccess,"http-request":e.uploadFile}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("选择文件")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"安卓配置","label-width":e.formLabelWidth}},[t("el-input",{attrs:{disabled:"",type:"textarea",autosize:"",resize:"none"},model:{value:e.form.androidConfig,callback:function(o){e.$set(e.form,"androidConfig",o)},expression:"form.androidConfig"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"ios配置","label-width":e.formLabelWidth}},[t("el-input",{attrs:{disabled:"",type:"textarea",autosize:"",resize:"none"},model:{value:e.form.iosConfig,callback:function(o){e.$set(e.form,"iosConfig",o)},expression:"form.iosConfig"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"windows配置","label-width":e.formLabelWidth}},[t("el-input",{attrs:{disabled:"",type:"textarea",autosize:"",resize:"none"},model:{value:e.form.windowsConfig,callback:function(o){e.$set(e.form,"windowsConfig",o)},expression:"form.windowsConfig"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(o){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.addUpdateConf}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var f=t("C7Lr")(n,d,!1,function(e){t("uDFT")},"data-v-3dddabb6",null);o.default=f.exports},uDFT:function(e,o){}});