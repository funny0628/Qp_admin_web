webpackJsonp([96],{OSbC:function(e,a,t){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var o=t("22Zk"),i=(o.a,{name:"whole_package_update",components:{InputArea:o.a},data:function(){return{loading:!1,apkloading:!1,showProgress:!1,percentage:0,currentPage:1,pageSize:10,total:0,dialogTitle:"",formLabelWidth:"120px",dialogFormVisible:!1,dialogVisible:!1,tableData:[],records:[],imageUrl:"",channelOpts:[],form:{version_id:null,channel:"",radio:"1",version:"",package_size:"",package_url:""},form2:{name:""}}},methods:{resetForm:function(){this.form={version_id:null,channel:"",radio:"1",version:"",package_size:"",package_url:""}},getWholePackageList:function(){var e=this;this.$http.get("v1/backend/sys-conf/package",{params:{page:this.currentPage,limit:this.pageSize}}).then(function(a){console.log(a),200===a.data.code&&(e.tableData=a.data.data,e.total=a.data.total)})},getAllChannelList:function(){var e=this;this.$http.post("v1/backend/no_channel",{type_id:2,add_id:2}).then(function(a){console.log(a),1===a.data.code&&(e.channelOpts=a.data.data)})},openAddDialog:function(){this.dialogFormVisible=!0,this.percentage=0,this.dialogTitle="添加版本管理信息"},addVersionUpdate:function(){var e=this;if(this.form.version_id){var a={version_id:this.form.version_id,channel:this.form.channel,version:this.form.version,status:Number(this.form.radio),package_size:this.form.package_size,package_url:this.form.package_url};this.$http.put("v1/backend/sys-conf/package",a).then(function(a){console.log(a),200===a.data.code?(e.dialogFormVisible=!1,e.getHistoryVersion(e.form.channel),e.getWholePackageList(),e.$message({type:"success",message:a.data.msg})):(e.dialogFormVisible=!1,e.$message({type:"info",message:a.data.msg}))})}else{var t={channel:this.form.channel,version:this.form.version,status:Number(this.form.radio),package_size:this.form.package_size,package_url:this.form.package_url};this.$http.post("v1/backend/sys-conf/package",t).then(function(a){console.log(a),200===a.data.code?(e.dialogFormVisible=!1,e.getWholePackageList(),e.$message({type:"success",message:a.data.msg})):(e.dialogFormVisible=!1,e.$message({type:"info",message:a.data.msg}))})}},getHistoryVersion:function(e){var a=this;this.$http.get("v1/backend/sys-conf/package/history",{params:{page:this.currentPage,limit:this.pageSize,channel:e}}).then(function(e){console.log(e),200==e.data.code&&(a.dialogVisible=!0,a.loading=!1,a.records=e.data.data)})},handleHistory:function(e){console.log(e),this.dialogTitle="编辑版本管理信息";var a=e.channel;this.loading=!0,this.getHistoryVersion(a)},handleEdit:function(e){console.log(e),this.dialogVisible=!1,this.dialogFormVisible=!0,this.form.version_id=e.id,this.form.channel=e.channel,this.form.radio=String(e.status),this.form.version=e.version,this.form.package_size=e.size,this.form.package_url=e.apk_update_url},handleDelete:function(e){var a=this;console.log(e);var t=e.channel;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.$http.delete("v1/backend/sys-conf/package",{params:{version_id:e.id}}).then(function(e){console.log(e),200===e.data.code&&(a.getHistoryVersion(t),a.getWholePackageList(),a.$message({type:"success",message:e.data.msg}))})}).catch(function(){a.$message({type:"info",message:res.data.msg})})},uploadFile:function(e){var a=this,t=e.file;console.log(t),this.showProgress=!0,this.apkloading=!0;var o=new FormData;o.append("file",t),o.append("file_name",t.name),o.append("package_size",t.size);var i={onUploadProgress:function(e){a.percentage=Number((e.loaded/e.total*100).toFixed(2))}};this.$http.post("v1/backend/sys-conf/package/upload",o,i).then(function(e){console.log(e),200==e.data.code?(a.showProgress=!1,a.apkloading=!1,a.$message({type:"success",message:"资源包上传成功"}),a.form.package_size=e.data.data.package_size,a.form.package_url=e.data.data.package_url):(a.showProgress=!1,a.apkloading=!1,a.$message({type:"info",message:"资源包上传失败"}))}).catch(function(e){a.$message({type:"error",message:"请求接口异常"}),a.showProgress=!1,a.apkloading=!1})},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.pageSize=e,this.getWholePackageList()},handleCurrentChange:function(e){console.log("当前页: "+e),this.currentPage=e,this.getWholePackageList()}},mounted:function(){this.getWholePackageList(),this.getAllChannelList()}}),l={render:function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",{attrs:{id:"whiteList-main"}},[e.showProgress?t("div",{staticClass:"mask"},[e.showProgress?t("el-progress",{staticClass:"progress",attrs:{"text-inside":!0,"stroke-width":26,percentage:e.percentage}}):e._e(),e._v(" "),100==e.percentage?t("span",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:e.apkloading,expression:"apkloading",modifiers:{fullscreen:!0}}],attrs:{"element-loading-text":"资源包整合中...","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.2)"}}):e._e()],1):e._e(),e._v(" "),t("input-area",[t("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.openAddDialog}},[e._v("添加")])],1),e._v(" "),t("div",{staticClass:"bd"},[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,"tooltip-effect":"dark"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"version",label:"更新版本",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"channel",label:"更新渠道",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.status?t("span",[e._v("启用")]):e._e(),e._v(" "),2==a.row.status?t("span",[e._v("禁用")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"modified_time",label:"更新时间",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{directives:[{name:"loading",rawName:"v-loading.fullscreen",value:e.loading,expression:"loading",modifiers:{fullscreen:!0}}],attrs:{"element-loading-text":"资源加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.5)",size:"mini",type:"primary"},on:{click:function(t){return e.handleHistory(a.row)}}},[e._v("历史版本")])]}}])})],1),e._v(" "),t("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.currentPage,"page-sizes":[10,15,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),t("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible},on:{"update:visible":function(a){e.dialogFormVisible=a}}},[t("el-form",{attrs:{model:e.form}},[t("el-form-item",{attrs:{label:"渠道","label-width":e.formLabelWidth}},[t("el-select",{attrs:{placeholder:"请选择渠道"},model:{value:e.form.channel,callback:function(a){e.$set(e.form,"channel",a)},expression:"form.channel"}},e._l(e.channelOpts,function(e,a){return t("el-option",{key:a,attrs:{label:e.channel_name,value:e.channel_code}})}),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"更新状态","label-width":e.formLabelWidth}},[t("el-radio",{attrs:{label:"1"},model:{value:e.form.radio,callback:function(a){e.$set(e.form,"radio",a)},expression:"form.radio"}},[e._v("启用")]),e._v(" "),t("el-radio",{attrs:{label:"2"},model:{value:e.form.radio,callback:function(a){e.$set(e.form,"radio",a)},expression:"form.radio"}},[e._v("禁用")])],1),e._v(" "),t("el-form-item",{attrs:{label:"文件","label-width":e.formLabelWidth}},[t("el-upload",{attrs:{action:"",accept:".apk","show-file-list":!1,"http-request":e.uploadFile}},[t("el-button",{attrs:{size:"small",type:"primary"}},[e._v("apk/ipa包上传")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"更新版本号","label-width":e.formLabelWidth}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.version,callback:function(a){e.$set(e.form,"version",a)},expression:"form.version"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"包大小(byte)","label-width":e.formLabelWidth}},[t("el-input",{attrs:{disabled:"",autocomplete:"off"},model:{value:e.form.package_size,callback:function(a){e.$set(e.form,"package_size",a)},expression:"form.package_size"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"整包地址","label-width":e.formLabelWidth}},[t("el-input",{attrs:{disabled:"",autocomplete:"off"},model:{value:e.form.package_url,callback:function(a){e.$set(e.form,"package_url",a)},expression:"form.package_url"}})],1)],1),e._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(a){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.addVersionUpdate}},[e._v("确 定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"编辑",visible:e.dialogVisible,width:"70%"},on:{"update:visible":function(a){e.dialogVisible=a}}},[t("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{border:"",data:e.records,"tooltip-effect":"dark"}},[t("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"version",label:"更新版本",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"channel",label:"更新渠道",align:"center"}}),e._v(" "),t("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.status?t("span",[e._v("启用")]):e._e(),e._v(" "),2==a.row.status?t("span",[e._v("禁用")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"modified_time",label:"更新时间",align:"center",width:"180"}}),e._v(" "),t("el-table-column",{attrs:{align:"center",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.handleEdit(a.row)}}},[e._v("编辑")]),e._v(" "),t("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.handleDelete(a.row)}}},[e._v("删除")])]}}])})],1)],1)],1)},staticRenderFns:[]};var n=t("C7Lr")(i,l,!1,function(e){t("hHVv")},"data-v-03791f6e",null);a.default=n.exports},hHVv:function(e,a){}});