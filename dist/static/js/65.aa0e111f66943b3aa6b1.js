webpackJsonp([65],{BCLz:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("22Zk"),i=(a.a,{name:"hot_update",components:{InputArea:a.a},data:function(){return{currentPage:1,pageSize:10,total:0,dialogTitle:"",formLabelWidth:"120px",dialogFormVisible:!1,dialogVisible:!1,tableData:[],form:{versionUpd:{radio:"*"},versionUpdCustom:"",channelUpd:{radio:"*"},channelUpdCustom:"",forbidUpdVersion:{radio:"*"},forbidUpdVersionCustom:"",forbidUpdChannel:{radio:"*"},forbidUpdChannelCustom:"",isPublic:{radio:"*"},isPublicCustom:"",updStatus:{radio:"1"},checkList:["1","2","3"],updateTime:"",version:"",update_type:"",update_way:""},fileData:{file:{},index:0,count:0,total_size:0,file_name:""},formData:{},imageUrl:"",pickerOptions:{shortcuts:[{text:"今天",onClick:function(e){e.$emit("pick",new Date)}},{text:"昨天",onClick:function(e){var t=new Date;t.setTime(t.getTime()-864e5),e.$emit("pick",t)}},{text:"一周前",onClick:function(e){var t=new Date;t.setTime(t.getTime()-6048e5),e.$emit("pick",t)}}]}}},filters:{formatPlatform:function(e){var t="",o=e.split(",");if(1==o.length)return 1==o[a]?t+="安卓":2==o[a]?t+="ios":t+="windows",t;for(var a=0;a<o.length;a++)1==o[a]?t+="安卓,":2==o[a]?t+="ios,":t+="windows";return t}},methods:{resetForm:function(){this.form={versionUpd:{radio:"*"},versionUpdCustom:"",channelUpd:{radio:"*"},channelUpdCustom:"",forbidUpdVersion:{radio:"*"},forbidUpdVersionCustom:"",forbidUpdChannel:{radio:"*"},forbidUpdChannelCustom:"",isPublic:{radio:"*"},isPublicCustom:"",updStatus:{radio:"1"},checkList:["1","2","3"],updateTime:"",version:"",update_type:"",update_way:""}},getHotUpdateList:function(){var e=this;this.$http.get("v1/backend/sys-conf/hot-update",{params:{page:this.currentPage,limit:this.pageSize}}).then(function(t){200===t.data.code&&(e.tableData=t.data.data,e.total=t.data.total)})},openAddDialog:function(){this.resetForm(),this.dialogTitle="添加信息",this.dialogFormVisible=!0},addUpdateConf:function(){var e=this,t={allow_version:"*"===this.form.versionUpd.radio?this.form.versionUpd.radio:this.form.versionUpdCustom,allow_channel:"*"===this.form.channelUpd.radio?this.form.channelUpd.radio:this.form.channelUpdCustom,deny_version:"*"===this.form.forbidUpdVersion.radio?this.form.forbidUpdVersion.radio:this.form.forbidUpdVersionCustom,deny_channel:"*"===this.form.forbidUpdChannel.radio?this.form.forbidUpdChannel.radio:this.form.forbidUpdChannelCustom,is_public:"*"===this.form.isPublic.radio?this.form.isPublic.radio:this.form.isPublicCustom,status:Number(this.form.updStatus.radio),clients:String(this.form.checkList),release_time:this.form.updateTime?parseInt(new Date(Number(this.form.updateTime)).getTime()/1e3):0,version_num:this.form.version,is_force:Number(this.form.update_type),update_type:Number(this.form.update_way),game_info:"我是game_info"};this.$http.post("v1/backend/sys-conf/hot-update",t).then(function(t){console.log(t),200===t.data.code&&(e.dialogFormVisible=!1,e.getHotUpdateList(),e.$message({type:"success",message:t.data.msg}))})},handleEdit:function(e){console.log(e),this.dialogTitle="编辑",this.dialogFormVisible=!0,this.form.id=e.id,"*"===e.allow_version?this.form.versionUpd.radio=e.allow_version:(this.form.versionUpd.radio="custom",this.form.versionUpdCustom=e.allow_version),"*"===e.allow_channel?this.form.channelUpd.radio=e.allow_channel:(this.form.channelUpd.radio="custom",this.form.channelUpdCustom=e.allow_version),"*"===e.deny_version?this.form.forbidUpdVersion.radio=e.deny_version:(this.form.forbidUpdVersion.radio="custom",this.form.forbidUpdVersionCustom=e.deny_version),"*"===e.deny_channel?this.form.forbidUpdChannel.radio=e.deny_channel:(this.form.forbidUpdChannel.radio="custom",this.form.forbidUpdChannelCustom=e.deny_channel),"*"===e.is_public?this.form.isPublic.radio=e.is_public:(this.form.isPublic.radio="custom",this.form.isPublicCustom=e.is_public),this.form.updStatus.radio=String(e.status),this.form.checkList=e.platform.split(","),this.form.updateTime=e.release_time,this.form.version=e.version,this.form.update_type=String(e.is_force),this.form.update_way=String(e.update_type)},handleDelete:function(e){var t=this;console.log(e),this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){t.$http.delete("v1/backend/sys-conf/hot-update",{params:{version_id:e.id}}).then(function(e){console.log(e),200===e.data.code&&(t.getHotUpdateList(),t.$message({type:"success",message:e.data.msg}))})}).catch(function(){t.$message({type:"info",message:res.data.msg})})},handleSizeChange:function(e){this.pageSize=e,this.getHotUpdateList()},handleCurrentChange:function(e){this.currentPage=e,this.getHotUpdateList()},handleAvatarSuccess:function(e,t){},handleChange:function(e,t){console.log(t)},uploadChunk:function(e,t){new FileReader;var o=Math.ceil(e.size/209715200);console.log(o);var a=209715200*t,i=a+209715200>=e.size?e.size:a+209715200;this.fileData.file=e.slice(a,i),this.fileData.index=t,this.fileData.count=o,this.fileData.total_size=e.size,this.fileData.file_name=e.name},loadNext:function(){var e=currentChunk*chunkSize,t=e+chunkSize>=file.size?file.size:e+chunkSize;fileReader.readAsBinaryString(file.slice(e,t))},beforeUpload:function(e){console.log(e);this.uploadChunk(e,0)},uploadFile:function(e){console.log(e.file);var t,o=this;(new FileReader).onload=((t=new FormData).append("file",o.fileData.file),t.append("index",o.fileData.index),t.append("count",o.fileData.count),t.append("total_size",o.fileData.total_size),t.append("file_name",o.fileData.file_name),void o.$http.post("v1/backend/sys-conf/hot-update/package",t).then(function(e){console.log(e)}))}},mounted:function(){this.getHotUpdateList()}}),r={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"hotUpdate-main"}},[o("input-area",[o("div",{staticStyle:{"margin-bottom":"10px"}},[o("el-button",{directives:[{name:"has",rawName:"v-has",value:"add_hot_update",expression:"'add_hot_update'"}],attrs:{type:"primary",size:"medium"},on:{click:e.openAddDialog}},[e._v("添加")])],1)]),e._v(" "),o("div",{staticClass:"bd"},[o("el-table",{directives:[{name:"has",rawName:"v-has",value:"hot_update_list",expression:"'hot_update_list'"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{border:"",data:e.tableData,"tooltip-effect":"dark"}},[o("el-table-column",{attrs:{prop:"id",label:"ID",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"version",label:"更新版本",align:"center"}}),e._v(" "),o("el-table-column",{attrs:{prop:"is_force",label:"是否强更",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.is_force?o("span",[e._v("强更")]):e._e(),e._v(" "),0===t.row.is_force?o("span",[e._v("非强更")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"update_type",label:"类型",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.update_type?o("span",[e._v("热更")]):e._e(),e._v(" "),0===t.row.update_type?o("span",[e._v("apk更新")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"allow_version",label:"允许版本",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["*"===t.row.allow_version?o("span",[e._v("所有")]):o("span",[e._v(e._s(t.row.allow_version))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"allow_channel",label:"允许渠道",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["*"===t.row.allow_channel?o("span",[e._v("所有")]):o("span",[e._v(e._s(t.row.allow_channel))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"platform",label:"平台",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("formatPlatform")(t.row.platform)))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"is_public",label:"版本公开",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["*"===t.row.is_public?o("span",[e._v("所有")]):o("span",[e._v(e._s(t.row.is_public))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"status",label:"状态",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.status?o("span",[e._v("启用")]):e._e(),e._v(" "),2===t.row.status?o("span",[e._v("禁止")]):e._e()]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"modified_time",label:"更新时间",align:"center",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(e._f("dateFormat")(t.row.modified_time)))])]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"action",label:"操作",fixed:"right",align:"center",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-button",{directives:[{name:"has",rawName:"v-has",value:"modify_hot_update",expression:"'modify_hot_update'"}],attrs:{size:"mini",type:"primary"},on:{click:function(o){return e.handleEdit(t.row)}}},[e._v("编辑")]),e._v(" "),o("el-button",{directives:[{name:"has",rawName:"v-has",value:"delete_hot_update",expression:"'delete_hot_update'"}],attrs:{size:"mini",type:"danger"},on:{click:function(o){return e.handleDelete(t.row)}}},[e._v("删除")])]}}])})],1),e._v(" "),o("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.currentPage,"page-sizes":[5,10,15,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),o("el-dialog",{attrs:{title:e.dialogTitle,visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[o("el-form",{attrs:{model:e.form}},[o("el-form-item",{attrs:{label:"允许版本更新","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"*"},model:{value:e.form.versionUpd.radio,callback:function(t){e.$set(e.form.versionUpd,"radio",t)},expression:"form.versionUpd.radio"}},[e._v("所有版本")]),e._v(" "),o("el-radio",{attrs:{label:"custom"},model:{value:e.form.versionUpd.radio,callback:function(t){e.$set(e.form.versionUpd,"radio",t)},expression:"form.versionUpd.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.versionUpd.radio?o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.versionUpdCustom,callback:function(t){e.$set(e.form,"versionUpdCustom",t)},expression:"form.versionUpdCustom"}}):e._e()],1),e._v(" "),o("el-form-item",{attrs:{label:"允许更新渠道","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"*"},model:{value:e.form.channelUpd.radio,callback:function(t){e.$set(e.form.channelUpd,"radio",t)},expression:"form.channelUpd.radio"}},[e._v("所有版本")]),e._v(" "),o("el-radio",{attrs:{label:"custom"},model:{value:e.form.channelUpd.radio,callback:function(t){e.$set(e.form.channelUpd,"radio",t)},expression:"form.channelUpd.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.channelUpd.radio?o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.channelUpdCustom,callback:function(t){e.$set(e.form,"channelUpdCustom",t)},expression:"form.channelUpdCustom"}}):e._e()],1),e._v(" "),o("el-form-item",{attrs:{label:"不允许更新版本","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"*"},model:{value:e.form.forbidUpdVersion.radio,callback:function(t){e.$set(e.form.forbidUpdVersion,"radio",t)},expression:"form.forbidUpdVersion.radio"}},[e._v("无")]),e._v(" "),o("el-radio",{attrs:{label:"custom"},model:{value:e.form.forbidUpdVersion.radio,callback:function(t){e.$set(e.form.forbidUpdVersion,"radio",t)},expression:"form.forbidUpdVersion.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.forbidUpdVersion.radio?o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.forbidUpdVersionCustom,callback:function(t){e.$set(e.form,"forbidUpdVersionCustom",t)},expression:"form.forbidUpdVersionCustom"}}):e._e()],1),e._v(" "),o("el-form-item",{attrs:{label:"不允许更新渠道","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"*"},model:{value:e.form.forbidUpdChannel.radio,callback:function(t){e.$set(e.form.forbidUpdChannel,"radio",t)},expression:"form.forbidUpdChannel.radio"}},[e._v("无")]),e._v(" "),o("el-radio",{attrs:{label:"custom"},model:{value:e.form.forbidUpdChannel.radio,callback:function(t){e.$set(e.form.forbidUpdChannel,"radio",t)},expression:"form.forbidUpdChannel.radio"}},[e._v("自定义")]),e._v(" "),"custom"===e.form.forbidUpdChannel.radio?o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.forbidUpdChannelCustom,callback:function(t){e.$set(e.form,"forbidUpdChannelCustom",t)},expression:"form.forbidUpdChannelCustom"}}):e._e()],1),e._v(" "),o("el-form-item",{attrs:{label:"是否公开","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"*"},model:{value:e.form.isPublic.radio,callback:function(t){e.$set(e.form.isPublic,"radio",t)},expression:"form.isPublic.radio"}},[e._v("所有人更新")]),e._v(" "),o("el-radio",{attrs:{label:"custom"},model:{value:e.form.isPublic.radio,callback:function(t){e.$set(e.form.isPublic,"radio",t)},expression:"form.isPublic.radio"}},[e._v("内部人更新")]),e._v(" "),"custom"===e.form.isPublic.radio?o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.isPublicCustom,callback:function(t){e.$set(e.form,"isPublicCustom",t)},expression:"form.isPublicCustom"}}):e._e()],1),e._v(" "),o("el-form-item",{attrs:{label:"更新状态","label-width":e.formLabelWidth}},[o("el-radio",{attrs:{label:"1"},model:{value:e.form.updStatus.radio,callback:function(t){e.$set(e.form.updStatus,"radio",t)},expression:"form.updStatus.radio"}},[e._v("启用")]),e._v(" "),o("el-radio",{attrs:{label:"2"},model:{value:e.form.updStatus.radio,callback:function(t){e.$set(e.form.updStatus,"radio",t)},expression:"form.updStatus.radio"}},[e._v("禁用")])],1),e._v(" "),o("el-form-item",{attrs:{label:"更新客户端","label-width":e.formLabelWidth}},[o("el-checkbox-group",{model:{value:e.form.checkList,callback:function(t){e.$set(e.form,"checkList",t)},expression:"form.checkList"}},[o("el-checkbox",{attrs:{label:"1"}},[e._v("android")]),e._v(" "),o("el-checkbox",{attrs:{label:"2"}},[e._v("ios")]),e._v(" "),o("el-checkbox",{attrs:{label:"3"}},[e._v("windows")])],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"更新时间","label-width":e.formLabelWidth}},[o("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间",align:"right","picker-options":e.pickerOptions},model:{value:e.form.updateTime,callback:function(t){e.$set(e.form,"updateTime",t)},expression:"form.updateTime"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"更新版本号","label-width":e.formLabelWidth}},[o("el-input",{attrs:{autocomplete:"off",placeholder:"请输入更新版本号"},model:{value:e.form.version,callback:function(t){e.$set(e.form,"version",t)},expression:"form.version"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"更新类型","label-width":e.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择更新类型"},model:{value:e.form.update_type,callback:function(t){e.$set(e.form,"update_type",t)},expression:"form.update_type"}},[o("el-option",{attrs:{label:"强更",value:"1"}}),e._v(" "),o("el-option",{attrs:{label:"非强更",value:"0"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"更新方式","label-width":e.formLabelWidth}},[o("el-select",{attrs:{placeholder:"请选择更新方式"},model:{value:e.form.update_way,callback:function(t){e.$set(e.form,"update_way",t)},expression:"form.update_way"}},[o("el-option",{attrs:{label:"热更",value:"1"}}),e._v(" "),o("el-option",{attrs:{label:"整包更新",value:"0"}})],1)],1),e._v(" "),o("el-form-item",{attrs:{label:"上传资源包","label-width":e.formLabelWidth}},[o("el-upload",{staticClass:"avatar-uploader",attrs:{action:"",accept:".zip","show-file-list":!1,"on-change":e.handleChange,"before-upload":e.beforeUpload,"on-success":e.handleAvatarSuccess,"http-request":e.uploadFile}},[e.imageUrl?o("img",{staticClass:"avatar",attrs:{src:e.imageUrl}}):o("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),o("el-form-item",{attrs:{label:"安卓配置","label-width":e.formLabelWidth}},[o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.android,callback:function(t){e.$set(e.form,"android",t)},expression:"form.android"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"ios配置","label-width":e.formLabelWidth}},[o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.ios,callback:function(t){e.$set(e.form,"ios",t)},expression:"form.ios"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"windows配置","label-width":e.formLabelWidth}},[o("el-input",{attrs:{type:"textarea",rows:4,resize:"none",placeholder:"请输入内容"},model:{value:e.form.windows,callback:function(t){e.$set(e.form,"windows",t)},expression:"form.windows"}})],1)],1),e._v(" "),o("div",[e._v(e._s(e.form))]),e._v(" "),o("div",[e._v(e._s(e.fileData))]),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:e.addUpdateConf}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var l=o("VU/8")(i,r,!1,function(e){o("bLwM")},"data-v-3f4c9071",null);t.default=l.exports},bLwM:function(e,t){}});
//# sourceMappingURL=65.aa0e111f66943b3aa6b1.js.map