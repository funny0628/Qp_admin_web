webpackJsonp([3],{XA0o:function(e,t){},"x+7F":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("ZLEe"),n=a.n(r),o=a("MgeX"),i=a.n(o),l=a("3cXf"),s=a.n(l),c=a("lC5x"),u=a.n(c),f=a("J0Oq"),d=a.n(f),_=a("4YfN"),h=a.n(_),m=(a("EuRQ"),{name:"rainmaker_config",data:function(){var e=function(e,t,a){if(""===t)return a(new Error("必填项不可以为空!!"));a()};return{tableData:[],visible:!1,form:{level:"",growth_value:"",award_coin:"",draw_num:"",icon_cash_cow_url:"",weight_info:""},initform:{level:"",growth_value:"",award_coin:"",draw_num:"",icon_cash_cow_url:"",weight_info:""},rules:{level:[{required:!0,validator:e,trigger:"blur"}],growth_value:[{required:!0,validator:e,trigger:"blur"}],award_coin:[{required:!0,validator:e,trigger:"blur"}],draw_num:[{required:!0,validator:e,trigger:"blur"}],weight_info:[{required:!0,validator:function(e,t,a){return""===t?a(new Error("必填项不可以为空!!")):/^([-+] ?)?[0-9]+(,[0-9]+)?(=[0-9]+)?$/.test(t)?void a():a(new Error("请按照提示的格式填写!!"))},trigger:"blur"}],icon_cash_cow_url:[{required:!0,validator:function(e,t,a){if(""===t)return a(new Error("必填项不可以为空!!"));a()},trigger:"blur"}]},title:"新增等级",keys:"",id:"",allData:{},servebg_url:"",loading:!1,ResData:{},imageChange:!1,currentIndex:-1}},created:function(){this.initData()},methods:{add:function(){this.editForm(!0,"新增",this.initform)},handleEdit:function(e,t){this.currentIndex=e,this.editForm(!0,"编辑",h()({},t))},handleDelete:function(e,t){var a=this;this.$confirm("确认永久删除？").then(function(t){a.tableData=a.tableData.filter(function(t,a){return e!==a}),a.initBackData(a.tableData)}).catch(function(e){a.$message({type:"info",message:"取消删除!"})})},send:function(e){var t=this;return d()(u.a.mark(function a(){return u.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.initBackData(t.tableData,e);case 1:case"end":return a.stop()}},a,t)}))()},upLoad:function(e){var t=this,a=new FormData;a.append("filename",e.file),a.append("types",1),this.$http.post("v1/backend/upload",a).then(function(e){1===e.data.code&&"ok"===e.data.msg&&(t.servebg_url=e.data.path)})},beforeAvatarUpload:function(e){e&&this.$set(this.form,"icon_cash_cow_url",URL.createObjectURL(e))},fileChange:function(e,t){e&&(this.imageChange=!0)},onSubmit:function(e,t){var a,r=this;this.$refs[e].validate((a=d()(u.a.mark(function e(a){var n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=6;break}"新增"===t?(r.form.icon_cash_cow_url=r.servebg_url,r.tableData.push(r.form),console.log(r.tableData)):"编辑"===t&&(r.imageChange&&(r.form.icon_cash_cow_url=r.servebg_url,r.imageChange=!1),n=[],r.tableData.forEach(function(e,t){n.push(e),r.currentIndex===t&&(n[t]=r.form)}),r.tableData=n,console.log(r.tableData)),r.initBackData(r.tableData,1),r.editForm(!1,"新增",r.initform),e.next=8;break;case 6:return r.$message({type:"warning",message:"必填的项不可以为空!"}),e.abrupt("return",!1);case 8:case"end":return e.stop()}},e,r)})),function(e){return a.apply(this,arguments)}))},back:function(){this.editForm(!1,"新增",this.initform)},initBackData:function(e,t){var a=this;return d()(u.a.mark(function r(){var o,l,c,f,d,_;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if((o=JSON.parse(s()(e))).forEach(function(e){e.level=+e.level,e.growth_value=+e.growth_value,e.award_coin=+e.award_coin,e.draw_num=+e.draw_num,e.weight_info=e.weight_info.split(",")}),o.forEach(function(e){var t={};e.weight_info.forEach(function(e,a){t[a+1]=e}),e.weight_info=t}),o.forEach(function(e,t){var a={},r={};i()(e.weight_info).forEach(function(e,t){r.coin=+e.split("=")[0],r.weight=+e.split("=")[1],e=r,a[t+1]=r}),e.weight_info=a}),console.log(o),l={},o.forEach(function(e,t){l[t+1]=e}),n()(a.ResData).forEach(function(e){"112"===e&&(a.ResData[e].ac_content.cash_cow=l)}),console.log(a.ResData),2!==t){r.next=18;break}return r.next=12,a.$http.HallFunConfig.PostActivityNew33({keys:a.keys,values:s()(a.ResData),id:a.id});case 12:c=r.sent,f=c.data,console.log(f),1===f.code&&"ok"===f.msg?(a.initData(),a.$message({type:"success",message:"发送服务器配置成功!"})):a.$message({type:"warning",message:"发送服务器配置失败!"}),r.next=23;break;case 18:return r.next=20,a.$http.HallFunConfig.PutActivityNew33({keys:a.keys,values:s()(a.ResData),id:a.id});case 20:d=r.sent,1===(_=d.data).code&&"ok"===_.msg?(a.initData(),a.$message({type:"success",message:"保存成功!"})):a.$message({type:"warning",message:"保存失败!"});case 23:case"end":return r.stop()}},r,a)}))()},editForm:function(e,t,a){this.visible=e,this.title=t,this.form=a},initData:function(){var e=this;return d()(u.a.mark(function t(){var a,r,o;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$http.HallFunConfig.GetActivityNew33({key:"activity_new.lua"});case 2:a=t.sent,r=a.data,console.log(r),e.keys=r.data[0].sys_key,e.id=r.data[0].id,o=r.data[0].sys_val,e.allData=JSON.parse(o),console.log(e.allData),e.ResData=JSON.parse(s()(e.allData)),console.log(e.ResData),n()(e.allData).forEach(function(t){"112"===t&&(e.tableData=i()(e.allData[t].ac_content.cash_cow))}),e.tableData.forEach(function(e){var t="";i()(e.weight_info).forEach(function(a){e.weight_info=t+=a.coin+"="+a.weight+",",e.weight_info=e.weight_info.substring(0,e.weight_info.lastIndexOf(","))})}),console.log(e.tableData,e.allData);case 15:case"end":return t.stop()}},t,e)}))()}}}),p={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],attrs:{id:"MoneyTree","element-loading-text":"正在上传中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(255, 255, 255, 0.6)"}},[a("div",{staticClass:"title"},[a("el-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("添加")]),e._v(" "),a("el-button",{directives:[{name:"has",rawName:"v-has",value:"rainmaker_config_send",expression:"'rainmaker_config_send'"}],attrs:{type:"primary"},on:{click:function(t){return e.send(2)}}},[e._v("发送服务器配置")])],1),e._v(" "),a("div",{directives:[{name:"has",rawName:"v-has",value:"rainmaker_config_detail",expression:"'rainmaker_config_detail'"}],staticClass:"table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"highlight-current-row":"","tooltip-effect":"dark",border:""}},[a("el-table-column",{attrs:{prop:"level",label:"等级",align:"center","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"draw_num",label:"摇奖次数",align:"center","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"icon_cash_cow_url",label:"摇钱树图标展示",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("img",{attrs:{src:e.$baseUrl+t.row.icon_cash_cow_url}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"award_coin",label:"全任务金币奖励",align:"center","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"growth_value",label:"升级所属成长值",align:"center","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"weight_info",label:"摇一摇奖励",align:"center","show-overflow-tooltip":""}}),e._v(" "),a("el-table-column",{attrs:{prop:"week_change",label:"操作",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return e.handleEdit(t.$index,t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){return e.handleDelete(t.$index,t.row)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("div",{staticClass:"form"},[a("el-dialog",{attrs:{title:e.title,visible:e.visible,"destroy-on-close":!0,width:"60%"},on:{"update:visible":function(t){e.visible=t}}},[a("el-form",{ref:"form",staticStyle:{"margin-top":"20px"},attrs:{rules:e.rules,model:e.form,"label-width":"150px"}},[a("el-form-item",{attrs:{label:"摇钱树等级",prop:"level"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"number",placeholder:"摇钱树等级"},model:{value:e.form.level,callback:function(t){e.$set(e.form,"level",t)},expression:"form.level"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"升级所需成长值",prop:"growth_value"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"number",placeholder:"0"},model:{value:e.form.growth_value,callback:function(t){e.$set(e.form,"growth_value",t)},expression:"form.growth_value"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"抽奖次数",prop:"award_coin"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"number",placeholder:"0"},model:{value:e.form.award_coin,callback:function(t){e.$set(e.form,"award_coin",t)},expression:"form.award_coin"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"摇钱树图展示",prop:"icon_cash_cow_url"}},[a("el-upload",{staticClass:"avatar-uploader",attrs:{action:"","show-file-list":!1,"http-request":e.upLoad,"before-upload":e.beforeAvatarUpload,"on-change":e.fileChange}},[e.form.icon_cash_cow_url?a("img",{staticClass:"avatar",attrs:{src:e.form.icon_cash_cow_url}}):a("i",{staticClass:"el-icon-plus avatar-uploader-icon"})])],1),e._v(" "),a("el-form-item",{attrs:{label:"全任务金币奖励数量",prop:"draw_num"}},[a("el-input",{staticStyle:{width:"220px"},attrs:{type:"number",placeholder:"0"},model:{value:e.form.draw_num,callback:function(t){e.$set(e.form,"draw_num",t)},expression:"form.draw_num"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"摇一摇金币奖励数量",prop:"weight_info"}},[a("el-input",{staticStyle:{width:"80%"},attrs:{placeholder:"1=2 ... 以 , 分隔"},model:{value:e.form.weight_info,callback:function(t){e.$set(e.form,"weight_info",t)},expression:"form.weight_info"}}),e._v(" "),a("p",[e._v("(金额1=权重1,金额2=权重2,...以 , 分隔)")])],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",staticStyle:{"margin-top":"20px"},attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"has",rawName:"v-has",value:"rainmaker_config_save",expression:"'rainmaker_config_save'"}],attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("form",e.title)}}},[e._v("保 存")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.back()}}},[e._v("返 回")])],1)],1)],1)])},staticRenderFns:[]};var v=a("C7Lr")(m,p,!1,function(e){a("XA0o")},"data-v-f616ef56",null);t.default=v.exports}});